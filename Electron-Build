cd ".\HST-WINDOWS-UTILITY"

# Clean .NET artifacts
dotnet clean

# Remove old build outputs
rd /s /q bin
rd /s /q obj
rd /s /q dist

# Build React frontend
cd ".\FRONTEND"
npm install
npm run build

# Build .NET backend
cd ".\HST-WINDOWS-UTILITY"
dotnet publish -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true /p:IncludeNativeLibrariesForSelfExtract=true

# Copy everything from publish folder to bin root for Electron to find
xcopy /E /I /Y "bin\Release\net8.0\win-x64\publish\*" "bin\"

# Build Electron app
npm install
npm run build

# Run the exe
dist\HST-WINDOWS-UTILITY-1.0.0.exe

# If the exe doesn't launch, run it directly from command prompt to see the error:
cd ".\HST-WINDOWS-UTILITY\dist"
HST-WINDOWS-UTILITY-1.0.0.exe